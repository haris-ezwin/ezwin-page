---
const heroTestimonials = [
  {
    name: "Aira",
    role: "P5 Student, 2025",
    quote: "You are the best teacher I ever have!",
  },
  {
    name: "Mdm Kamilah",
    role: "Parent of Aira, 2025",
    quote: "Aira really loves your lessons.",
  },
  {
    name: "Mdm Grace",
    role: "Parent, P5 2025",
    quote: "Jing En prefers you over another tutor we had.",
  },
  {
    name: "Mdm Venus",
    role: "Parent, P6 2026",
    quote:
      "Ur explanation is very very clear - she (my kid) is super weak in fraction and now she can catch up a bit...",
  },
  {
    name: "Claire",
    role: "Parent, P6 2026",
    quote:
      "Hi Haris, the session today went well. It was structured, clear. The LMS application logic is good too.",
  },
];

const heroMathChips = [
  { symbol: "+", color: "#FFD74A" }, // lightbulb yellow
  { symbol: "-", color: "#F56CB9" }, // magenta frame F56CB9
  { symbol: "x", color: "#9B72FF" }, // cap purple 9B72FF
  { symbol: "รท", color: "#48E1C6" }, // mint book
];

const parentIcon = "/items/parent.svg";
const studentIcon = "/items/open-arm.svg";

const isParentRole = (role) =>
  String(role || "")
    .toLowerCase()
    .includes("parent");
const getRoleIcon = (role) => (isParentRole(role) ? parentIcon : studentIcon);
const getRoleIconAlt = (role) =>
  isParentRole(role) ? "Parent icon" : "Student icon";
---

<main class="relative bg-background pt-12 pb-0 overflow-hidden">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div
      class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8 lg:gap-12 items-start">
      <div class="text-left">
        <div class="flex items-center gap-2 mb-4">
          {
            heroMathChips.map((chip) => (
              <span
                class="inline-flex items-center justify-center w-9 h-9 rounded-full text-sm font-semibold"
                style={`background:${chip.color};color:#0f172a;`}>
                {chip.symbol}
              </span>
            ))
          }
        </div>
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-6 uppercase">
          Singapore Online Primary 5 and 6 PSLE Math 1 on 1 Tuition
        </h1>
        <div class="mb-4">
          <span
            class="inline-flex items-center rounded-full bg-amber-100 text-amber-900 text-base md:text-lg font-semibold px-4 py-1.5">
            No improvements in first month, money back guarantee
            <svg
              class="ml-2 h-4 w-4 md:h-5 md:w-5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true">
              <path d="M12 2l7 4v6c0 5-3.5 9.5-7 10-3.5-.5-7-5-7-10V6l7-4z"
              ></path>
              <path d="M9 12l2 2 4-4"></path>
            </svg>
          </span>
        </div>
        <p class="text-lg md:text-xl text-gray-700 mb-8">
          We help your child understand hard math topics like fractions and math
          problem sums in paper 2 math exams, using personalised learning.
        </p>
      </div>
      <div
        class="w-full"
        id="hero-testimonials"
        data-hero-testimonials={encodeURIComponent(
          JSON.stringify(heroTestimonials),
        )}>
        <div class="lg:hidden overflow-hidden mb-4">
          <div
            id="hero-testimonial-rotator-content"
            class="bg-white border border-gray-200 shadow-sm rounded-2xl p-5 flex flex-col gap-2 will-change-transform">
            <div class="flex gap-1 text-yellow-400">
              {
                Array.from({ length: 5 }).map(() => (
                  <svg
                    class="w-3.5 h-3.5"
                    viewBox="0 0 20 20"
                    fill="currentColor">
                    <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                  </svg>
                ))
              }
            </div>
            <p
              id="hero-testimonial-rotator-text"
              class="text-sm text-gray-800 leading-relaxed">
              "{heroTestimonials[0].quote}"
            </p>
            <p class="text-xs font-semibold text-gray-900">
              <img
                id="hero-testimonial-rotator-icon"
                class="inline-block w-4 h-4 mr-2 align-middle"
                src={getRoleIcon(heroTestimonials[0].role)}
                alt={getRoleIconAlt(heroTestimonials[0].role)}
              />
              <span id="hero-testimonial-rotator-name"
                >{heroTestimonials[0].name}</span
              >
              <span class="text-gray-500 font-normal">
                (
                <span id="hero-testimonial-rotator-role">
                  {heroTestimonials[0].role}
                </span>
                )
              </span>
            </p>
          </div>
        </div>
        <div class="hidden lg:block lg:columns-2 [column-gap:0.75rem]">
          {
            heroTestimonials.map((testimonial) => (
              <div class="bg-white border border-gray-200 shadow-sm rounded-2xl p-5 lg:p-6 break-inside-avoid mb-3">
                <div class="flex gap-1 text-yellow-400 mb-2">
                  {Array.from({ length: 5 }).map(() => (
                    <svg
                      class="w-3.5 h-3.5"
                      viewBox="0 0 20 20"
                      fill="currentColor">
                      <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                    </svg>
                  ))}
                </div>
                <p class="text-sm md:text-base text-gray-800 leading-relaxed mb-2">
                  "{testimonial.quote}"
                </p>
                <p class="text-xs md:text-sm font-semibold text-gray-900">
                  <img
                    class="inline-block w-4 h-4 mr-2 align-middle"
                    src={getRoleIcon(testimonial.role)}
                    alt={getRoleIconAlt(testimonial.role)}
                  />
                  {testimonial.name}
                  <span class="text-gray-500 font-normal">
                    ({testimonial.role})
                  </span>
                </p>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</main>

<script is:inline>
  const heroTestimonialsEl = document.getElementById("hero-testimonials");
  const heroTestimonials = heroTestimonialsEl
    ? JSON.parse(
        decodeURIComponent(heroTestimonialsEl.dataset.heroTestimonials || "[]"),
      )
    : [];
  const heroContentEl = document.getElementById(
    "hero-testimonial-rotator-content",
  );
  const parentIcon = "/items/parent.svg";
  const studentIcon = "/items/open-arm.svg";

  function isParentRole(role) {
    return String(role || "")
      .toLowerCase()
      .includes("parent");
  }

  function applyHeroTestimonial(testimonial) {
    const textEl = document.getElementById("hero-testimonial-rotator-text");
    const nameEl = document.getElementById("hero-testimonial-rotator-name");
    const roleEl = document.getElementById("hero-testimonial-rotator-role");
    const iconEl = document.getElementById("hero-testimonial-rotator-icon");
    if (!textEl || !nameEl || !roleEl || !testimonial) return;
    const parentRole = isParentRole(testimonial.role);
    textEl.textContent = `"${testimonial.quote}"`;
    nameEl.textContent = testimonial.name;
    roleEl.textContent = testimonial.role;
    if (iconEl) {
      iconEl.src = parentRole ? parentIcon : studentIcon;
      iconEl.alt = parentRole ? "Parent icon" : "Student icon";
    }
  }

  function renderHeroTestimonial(index, animate = true) {
    const testimonial = heroTestimonials[index];
    if (!testimonial) return;

    if (!animate || !heroContentEl) {
      applyHeroTestimonial(testimonial);
      return;
    }

    heroContentEl.style.transition = "none";
    heroContentEl.style.transform = "translateX(-105%)";

    requestAnimationFrame(() => {
      applyHeroTestimonial(testimonial);
      requestAnimationFrame(() => {
        heroContentEl.style.transition = "transform 450ms ease-out";
        heroContentEl.style.transform = "translateX(0)";
      });
    });
  }

  function startHeroTestimonialLoop() {
    const rotator = document.getElementById("hero-testimonials");
    if (!rotator || heroTestimonials.length === 0) return;

    let heroIndex = 0;
    renderHeroTestimonial(heroIndex, false);
    setInterval(() => {
      heroIndex = (heroIndex + 1) % heroTestimonials.length;
      renderHeroTestimonial(heroIndex);
    }, 4500);
  }

  if (typeof window !== "undefined") {
    window.addEventListener("DOMContentLoaded", startHeroTestimonialLoop);
  }
</script>
