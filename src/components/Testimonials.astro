---
const testimonials = [
  {
    id: 1,
    name: "Aira",
    role: "P5 Student, 2025",
    content: "You are the best teacher I ever have!",
  },
  {
    id: 2,
    name: "Mdm Kamilah",
    role: "Parent of Aira, 2025",
    content: "Aira really loves your lessons",
  },
  {
    id: 3,
    name: "Mdm Grace",
    role: "Parent of Jing En, 2025",
    content: "Jing En prefers your over another tutor we had",
  },
];
---

<section class="w-full">
  <div class="mx-auto max-w-7xl px-6 lg:px-8 py-0">
    <div id="testimonial-rotator" class="lg:hidden">
      <div class="flex flex-col gap-2">
        <div class="flex gap-0.5 text-yellow-400">
          {
            Array.from({ length: 5 }).map(() => (
              <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
              </svg>
            ))
          }
        </div>
        <p
          id="testimonial-rotator-text"
          class="text-sm text-gray-800 leading-relaxed">
          "{testimonials[0].content}"
        </p>
        <p class="text-sm text-gray-900 font-medium">
          <span id="testimonial-rotator-name">{testimonials[0].name}</span>
          <span class="text-gray-500">
            (<span id="testimonial-rotator-role">{testimonials[0].role}</span
            >)</span
          >
        </p>
      </div>
    </div>

    <div class="hidden lg:grid grid-cols-3 gap-10">
      {
        testimonials.map((testimonial) => (
          <div class="flex flex-col gap-2">
            <div class="flex gap-0.5 text-yellow-400">
              {Array.from({ length: 5 }).map(() => (
                <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                </svg>
              ))}
            </div>
            <p class="text-sm text-gray-800 leading-relaxed">
              "{testimonial.content}"
            </p>
            <p class="text-sm text-gray-900 font-medium">
              {testimonial.name}
              <span class="text-gray-500"> ({testimonial.role})</span>
            </p>
          </div>
        ))
      }
    </div>
  </div>

  <script is:inline>
    const testimonials = JSON.parse(
      decodeURIComponent("{encodeURIComponent(JSON.stringify(testimonials))}")
    );
    let testimonialIndex = 0;

    function renderTestimonial(index) {
      const textEl = document.getElementById("testimonial-rotator-text");
      const nameEl = document.getElementById("testimonial-rotator-name");
      const roleEl = document.getElementById("testimonial-rotator-role");
      const testimonial = testimonials[index];

      if (textEl && nameEl && roleEl && testimonial) {
        textEl.textContent = `"${testimonial.content}"`;
        nameEl.textContent = testimonial.name;
        roleEl.textContent = testimonial.role;
      }
    }

    function startTestimonialLoop() {
      const rotator = document.getElementById("testimonial-rotator");
      if (!rotator) return;

      renderTestimonial(testimonialIndex);
      setInterval(() => {
        testimonialIndex = (testimonialIndex + 1) % testimonials.length;
        renderTestimonial(testimonialIndex);
      }, 1000);
    }

    if (typeof window !== "undefined") {
      window.addEventListener("DOMContentLoaded", startTestimonialLoop);
    }
  </script>
</section>
