---
const testimonials = [
  {
    id: 1,
    name: "Aira",
    role: "P5 Student, 2025",
    content: "You are the best teacher I ever have!",
  },
  {
    id: 2,
    name: "Mdm Kamilah",
    role: "Parent of Aira, 2025",
    content: "Aira really loves your lessons",
  },
  {
    id: 3,
    name: "Mdm Grace",
    role: "Parent of Jing En, 2025",
    content: "Jing En prefers your over another tutor we had",
  },
];
---

<section
  id="testimonials-section"
  class="w-full"
  data-testimonials={encodeURIComponent(JSON.stringify(testimonials))}>
  <div class="mx-auto max-w-7xl px-6 lg:px-8 pt-8 lg:pt-0 pb-0">
    <div id="testimonial-rotator" class="lg:hidden overflow-hidden">
      <div
        id="testimonial-rotator-content"
        class="flex flex-col gap-2 will-change-transform">
        <div class="flex gap-0.5 text-yellow-400">
          {
            Array.from({ length: 5 }).map(() => (
              <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
              </svg>
            ))
          }
        </div>
        <p
          id="testimonial-rotator-text"
          class="text-sm text-gray-800 leading-relaxed">
          "{testimonials[0].content}"
        </p>
        <p class="text-sm text-gray-900 font-medium">
          <span id="testimonial-rotator-name">{testimonials[0].name}</span>
          <span class="text-gray-500">
            (<span id="testimonial-rotator-role">{testimonials[0].role}</span
            >)</span
          >
        </p>
      </div>
    </div>

    <div class="hidden lg:grid grid-cols-3 gap-10">
      {
        testimonials.map((testimonial) => (
          <div class="flex flex-col gap-2">
            <div class="flex gap-0.5 text-yellow-400">
              {Array.from({ length: 5 }).map(() => (
                <svg class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                </svg>
              ))}
            </div>
            <p class="text-sm text-gray-800 leading-relaxed">
              "{testimonial.content}"
            </p>
            <p class="text-sm text-gray-900 font-medium">
              {testimonial.name}
              <span class="text-gray-500"> ({testimonial.role})</span>
            </p>
          </div>
        ))
      }
    </div>
  </div>

  <script is:inline>
    const testimonialsSection = document.getElementById("testimonials-section");
    const testimonials = testimonialsSection
      ? JSON.parse(
          decodeURIComponent(testimonialsSection.dataset.testimonials || "[]"),
        )
      : [];
    let testimonialIndex = 0;
    const contentEl = document.getElementById("testimonial-rotator-content");

    function applyTestimonial(testimonial) {
      const textEl = document.getElementById("testimonial-rotator-text");
      const nameEl = document.getElementById("testimonial-rotator-name");
      const roleEl = document.getElementById("testimonial-rotator-role");

      if (!textEl || !nameEl || !roleEl || !testimonial) return;
      textEl.textContent = `"${testimonial.content}"`;
      nameEl.textContent = testimonial.name;
      roleEl.textContent = testimonial.role;
    }

    function renderTestimonial(index, animate = true) {
      const testimonial = testimonials[index];
      if (!testimonial) return;

      if (!animate || !contentEl) {
        applyTestimonial(testimonial);
        return;
      }

      contentEl.style.transition = "none";
      contentEl.style.transform = "translateX(-105%)";

      requestAnimationFrame(() => {
        applyTestimonial(testimonial);
        requestAnimationFrame(() => {
          contentEl.style.transition = "transform 450ms ease-out";
          contentEl.style.transform = "translateX(0)";
        });
      });
    }

    function startTestimonialLoop() {
      const rotator = document.getElementById("testimonial-rotator");
      if (!rotator || testimonials.length === 0) return;

      renderTestimonial(testimonialIndex, false);
      setInterval(() => {
        testimonialIndex = (testimonialIndex + 1) % testimonials.length;
        renderTestimonial(testimonialIndex);
      }, 4500);
    }

    if (typeof window !== "undefined") {
      window.addEventListener("DOMContentLoaded", startTestimonialLoop);
    }
  </script>
</section>
